---
title: Google App Scriptã§Boxãƒ•ã‚©ãƒ«ãƒ€ã‚ªãƒ¼ãƒŠãƒ¼ä¸€è¦§ã‚’èª¿æŸ»ã™ã‚‹
tags:
 - GAS 
 - box
 - google
 - appscript
---

# ã¯ã˜ã‚ã«
boxã‚’é•·ãä½¿ã£ã¦ã„ã‚‹ã¨ã€è‰²ã‚“ãªäººã«æ‹›å¾…ã•ã‚Œã¦ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãŒè‹¥å¹²ã‚«ã‚ªã‚¹ãªçŠ¶æ…‹ã«ãªã‚ŠãŒã¡ã§ã™ã€‚
æ•´ç†ã‚’ã—ã‚ˆã†ã«ã‚‚ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ãŒèª°ãªã®ã‹åˆ†ã‹ã‚‰ãšã€ç¢ºèªã—ãŸãã¦ã‚‚ä¸€å€‹ä¸€å€‹ç›®è¦–ã—ã¦ã„ãã®ã‚‚çµæ§‹å¤§å¤‰
ç®¡ç†è€…ã«é ¼ã‚“ã§ãƒªã‚¹ãƒˆã‚’å‡ºã—ã¦ã‚‚ã‚‰ã†ã®ã‚ã‚Šã ã‘ã©ã€ç®¡ç†è€…ã‚‚ãƒ’ãƒã˜ã‚ƒãªã„ã ã‚ã†ã—ã€å‡ºæ¥ã‚‹ã“ã¨ãªã‚‰è‡ªåˆ†ã§ãƒªã‚¹ãƒˆã‚’å‡ºã—ãŸã„ã€‚
![](https://cloud.box.com/shared/static/qefb6l7l4bixjnzfwy2e52q5s7afixiw.png)
---


# Google App Scriptã‚’ä½¿ã£ã¦ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã®ä¸€è¦§ã‚’å‡ºåŠ›ã™ã‚‹

ä¸€è¦§ãŒæ¬²ã—ã„ã ã‘ãªã‚‰ã€Box APIã‚’å©ã„ã¦ä¸€è¦§ã‚’jsonã§å–å¾—ã¯å‡ºæ¥ã‚‹ãŒå¯èª­æ€§ãŒä½ã„ã—ã€æƒ…å ±é‡ãŒå¤šã™ãã‚‹ã€‚
ã‚‚ã£ã¨æ‰‹è»½ã«ãƒªã‚¹ãƒˆåŒ–ã™ã‚‹æ–¹æ³•ã¯ãªã„ã‹ã€‚

ğŸ’¡ãƒ”ã‚³ãƒ¼ãƒ³ãƒƒï¼Google App Scriptä½¿ã£ã¦æ¬²ã—ã„æƒ…å ±ã ã‘ã‚»ãƒ«ã«è½ã¨ã—è¾¼ã‚ã°ã„ã„ã‚“ã˜ã‚ƒã­ï¼Ÿ
ãã‚Œã¨ã€ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’Boxä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ãŸã‚‰ã€äºŒåº¦ã†ã¾ã„ã€‚

[ãƒ‡ãƒ¢å‹•ç”»ï¼šã‚„ã£ã¦ã¿ãŸã€‚](https://cloud.app.box.com/s/ymq0kok9btd1ttp0iohfsn8iwmrc2kfg)
--- 

## Google App Script

Google App Sciprté€šç§°GASï¼ˆã‚¬ãƒ¼ã‚¹ãƒ¼é»’å…‰ã‚Šæ¢åµç¤¾ã˜ã‚ƒãªã„ã‚ˆï¼‰ã¯ã€å¹³ãŸãè¨€ã†ã¨Officeã§ã„ã†ã¨ã“ã‚ã®ãƒã‚¯ãƒ­ã«ã‚ãŸã‚‹å­˜åœ¨ã€‚
å¤§ããªé•ã„ã¯Gappsä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã¨ã€åŸºæœ¬æ§‹æ–‡ãŒJavascriptã«è¿‘ã„
å‚è€ƒï¼š[ã¯ã˜ã‚ã¦ã®Google App Scripts](https://qiita.com/syokoyama/items/d071b1df2b66ba70f564)

ã¾ãšã¯ã€è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```Javascript
function getNames(){
  //box api: folderä¸€è¦§ã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  aUrl = "https://api.box.com/2.0/folders/0/items";
  //box API Access Tokenã®å…¥åŠ›ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æ±‚ã‚ã‚‹
  //é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚‚å¯èƒ½
  var atoken = Browser.inputBox('Access token?', 'access token', Browser.Buttons.OK_CANCEL);
  
  //Get requestã®ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã‚’ç”¨æ„
  headers = {'Authorization' : 'Bearer ' + atoken};
  params = {'headers' : headers};  
  
  //Folderæƒ…å ±ã‚’å–å¾—
  var response = UrlFetchApp.fetch(aUrl ,params); // get api endpoint
  var dataAll = JSON.parse(response.getContentText()); //
  var data = dataAll.entries; //parse text into json
  
  //Google Sheetã®å–å¾—
  var ss = SpreadsheetApp.getActiveSpreadsheet(); //get active spreadsheet
  var sheet = ss.getActiveSheet(); //get sheet by name from active spreadsheet
ã€€Logger.log(data); //log data to logger to check
 
  //ãƒ˜ãƒƒãƒ€ãƒ¼ã‚«ãƒ©ãƒ æƒ…å ±ã‚’å…¥åŠ›
  var columns=[];
  columns.push("Folder name");
  columns.push("Folder ID");
  columns.push("Folder Owned By");
  sheet.appendRow(columns);
  columns.splice(0, columns.length);

  //Folderæƒ…å ±ã®å–å¾—
  for (i in data){
    if (data[i].type === 'folder'){
    folderOwner(data[i].id, atoken);
    }
  }
}

function folderOwner(folderid,atoken){
  //Folderæƒ…å ±å–å¾—ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  aUrl = "https://api.box.com/2.0/folders/";
  headers = {'Authorization' : 'Bearer ' + atoken};
  params = {'headers' : headers};  
  var response = UrlFetchApp.fetch(aUrl + folderid ,params); // get api endpoint
  var dataAll = JSON.parse(response.getContentText()); //
  var stats=[]; //create empty array to hold data points
  var ss = SpreadsheetApp.getActiveSpreadsheet(); //get active spreadsheet
  var sheet = ss.getActiveSheet(); //get sheet from active spreadsheet
ã€€Logger.log(data); //log data to logger to check
 
  stats.push(dataAll.name);
  stats.push(dataAll.id);
  stats.push(dataAll.owned_by.login);
  sheet.appendRow(stats)           
  stats.splice(0, stats.length);
}
```

*ä»Šå›ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€Access Tokenã‚’ç›´æ¥å…¥ã‚Œã‚‹ã‚ˆã†æ±‚ã‚ã¦ã„ã‚‹ãŒã€OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’Google App Scriptã«å…¥ã‚Œã‚‹ã“ã¨ã‚‚æŠ€è¡“ãƒ†ã‚¸ãƒ¥ã«ã¯å¯èƒ½ã€‚
ã“ã‚Œã‚’ä½¿ã†ã¨å‡ºæ¥ã‚‹ã‚‰ã—ã„ã€‚ã€‚ã€‚ãŒæ™‚é–“ãŒãªãè©¦ã—ã¦ã„ãªã„
https://github.com/googlesamples/apps-script-oauth2


æ¬¡ã«ã€å‡ºåŠ›ã—ãŸGsheetã‚’Excelã«å¤‰æ›ã—ã¦ã€Boxã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```Javascript
function exportFile(){
  
  //box API Access Tokenã®å…¥åŠ›ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æ±‚ã‚ã‚‹
  //é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚‚å¯èƒ½
  var atoken = Browser.inputBox('Access token?', 'access token', Browser.Buttons.OK_CANCEL);
  var ss = SpreadsheetApp.getActive();
  
  //Gsheetã‚’Excelã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  var url = "https://docs.google.com/feeds/download/spreadsheets/Export?key=" + ss.getId() + "&exportFormat=xlsx";
  
  //Gsheetã®èªè¨¼æƒ…å ±ã‚’ç”¨æ„ã™ã‚‹
  var params = {
  method      : "get",
  headers     : {"Authorization": "Bearer " + ScriptApp.getOAuthToken()},
  //muteHttpExceptions: true
  };
  
  //Excelãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  var blob = UrlFetchApp.fetch(url, params).getBlob();
  var blobName = blob.setName(ss.getName() + ".xlsx");


  //Boxã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™ã€‚Multipart formã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«ã™ã‚‹ãŸã‚è‰²ã€…ç”¨æ„
  //è©³ã—ãã¯ã“ã¡ã‚‰â†’https://developer.box.com/v2.0/reference#upload-a-file
  var boundary = "boxob";
  //ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹FolderIDç›´æ‰“ã¡ã«ã—ã¦ã„ã¾ã™ãŒã€å¥½ãã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå‡ºæ¥ã‚‹ã€‚
  var attributes = "{\"name\":\"FolderList.xlsx\", \"parent\":{\"id\":\"40985326479\"}}";
  
  var requestBody = Utilities.newBlob(
    "--"+boundary+"\r\n"
    + "Content-Disposition: form-data; name=\"attributes\"\r\n\r\n"
    + attributes+"\r\n"+"--"+boundary+"\r\n"
    + "Content-Disposition: form-data; name=\"file\"; filename=\""+blobName+"\"\r\n"
  + "Content-Type: " + blob.getContentType()+"\r\n\r\n").getBytes()
  .concat(blob.getBytes())
  .concat(Utilities.newBlob("\r\n--"+boundary+"--\r\n").getBytes());
  
  var options = {
    method: "post",
    contentType: "multipart/form-data; boundary="+boundary,
    payload: requestBody,
    muteHttpExceptions: true,
    headers: {'Authorization': 'Bearer ' + atoken}
  };

  //Boxã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  var request = UrlFetchApp.fetch("https://upload.box.com/api/2.0/files/content", options);

  Logger.log(request.getContentText());
  
}
```

# ã“ã®é€£æºã«ã‚ãŸã£ã¦å‚è€ƒã«ã—ãŸæƒ…å ±

[Google Apps Scriptã‹ã‚‰HTTP POST](https://qiita.com/n0bisuke/items/a31a99232e50461eb00f)
[External APIs](https://developers.google.com/apps-script/guides/services/external)
